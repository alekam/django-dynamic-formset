(function(e){e.fn.formset=function(t){var n=e.extend({},e.fn.formset.defaults,t),r=n.extraClasses.join(" "),i=e(this),s=i.parent(),o=function(e,t){if(n.extraClasses){e.removeClass(r);e.addClass(n.extraClasses[t%n.extraClasses.length])}},u=function(e,t,n){var r=new RegExp("("+t+"-\\d+-)"),i=t+"-"+n+"-";if(e.attr("for"))e.attr("for",e.attr("for").replace(r,i));if(e.attr("id"))e.attr("id",e.attr("id").replace(r,i));if(e.attr("name"))e.attr("name",e.attr("name").replace(r,i))},a=function(e){return e.find("input,select,textarea,label").length>0},f=function(t){if(!n.useDeleteLinks){return}if(t.is("TR")){t.children(":last").append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}else if(t.is("UL")||t.is("OL")){t.append('<li><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></li>")}else{t.append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}t.find("a."+n.deleteCssClass).click(function(){var t=e(this).parents("."+n.formCssClass),r=t.find('input:hidden[id $= "-DELETE"]');if(n.beforeremove)n.beforeremove(t);if(r.length){r.val("on");t.hide()}else{t.remove();var i=e("."+n.formCssClass).not(".formset-custom-template");e("#id_"+n.prefix+"-TOTAL_FORMS").val(i.length);for(var s=0,a=i.length;s<a;s++){o(i.eq(s),s);i.eq(s).find("input,select,textarea,label").each(function(){u(e(this),n.prefix,s)})}}l();if(n.removed)n.removed(t);return false})},l=function(){var t=parseInt(e("#id_"+n.prefix+"-MAX_NUM_FORMS").val()),r=s.find("."+n.formCssClass).length;if(n.min_num>0){if(r<=n.min_num){s.find("."+n.deleteCssClass).hide()}else{s.find("."+n.deleteCssClass+":gt("+(n.min_num-1)+")").show()}}if(t>0){if(r>=t){s.find("."+n.addCssClass).hide()}else{s.find("."+n.addCssClass).show()}}};i.each(function(t){var r=e(this),i=r.find('input:checkbox[id $= "-DELETE"]');if(i.length){i.before('<input type="hidden" name="'+i.attr("name")+'" id="'+i.attr("id")+'" />');i.remove()}if(a(r)){f(r);r.addClass(n.formCssClass);o(r,t)}l()});if(i.length){var c,h;if(n.formTemplate){h=n.formTemplate instanceof e?n.formTemplate:e(n.formTemplate);h.removeAttr("id").addClass(n.formCssClass).addClass("formset-custom-template");h.find("input,select,textarea,label").each(function(){u(e(this),n.prefix,2012)});f(h)}else{h=e("."+n.formCssClass+":last").clone(true).removeAttr("id");h.find('input:hidden[id $= "-DELETE"]').remove();h.find("input,select,textarea,label").each(function(){var t=e(this);if(t.is("input:checkbox")||t.is("input:radio")){t.attr("checked",false)}else{t.val("")}})}n.formTemplate=h;if(i.attr("tagName")=="TR"){var p=i.eq(0).children().length;i.parent().append('<tr><td colspan="'+p+'"><a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a></tr>");c=i.parent().find("tr:last a");c.parents("tr").addClass(n.formCssClass+"-add")}else{i.filter(":last").after('<a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a>");c=i.filter(":last").next()}c.click(function(){var t=parseInt(e("#id_"+n.prefix+"-TOTAL_FORMS").val()),r=n.formTemplate.clone(true).removeClass("formset-custom-template"),i=e(this).parents("tr."+n.formCssClass+"-add").get(0)||this;o(r,t);if(n.beforeadd)n.beforeadd(r);r.insertBefore(e(i)).show();r.find("input,select,textarea,label").each(function(){var r=e(this);u(r,n.prefix,t);if(r.is("input:checkbox")||r.is("input:radio")){r.attr("checked",false)}else{r.val("")}});e("#id_"+n.prefix+"-TOTAL_FORMS").val(t+1);l();if(n.added)n.added(r);return false});l()}return i};e.fn.formset.defaults={prefix:"form",min_num:0,formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],beforeadd:null,added:null,beforeremove:null,removed:null,useDeleteLinks:true}})(jQuery)
